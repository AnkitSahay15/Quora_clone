"use strict";var app=angular.module("quora",["ui.router"]);app.constant("tokenStorageKey","my-token"),app.config(function(t,e,o){t.state("home",{url:"/",templateUrl:"/html/general/home.html",controller:"homeCtrl"}).state("users",{"abstract":!0,templateUrl:"/html/users/users.html"}).state("post",{url:"/post",templateUrl:"/html/general/post.html",controller:"postCtrl"}).state("users.login",{url:"/login",templateUrl:"/html/users/form.html",controller:"usersCtrl"}).state("users.profile",{url:"/profile",templateUrl:"/html/users/profile.html",controller:"profileCtrl"}),o.otherwise("/")}),app.controller("homeCtrl",function(t,e){}),app.controller("postCtrl",function(t,e){console.log("POST CTRL WORKING")}),app.controller("profileCtrl",function(t,e){console.log("PROFILE CTRL WORKING")}),app.controller("usersCtrl",function(t,e,o){t.Login=!1,t.LoggedIn=!0,(t.switchState=function(){t.Login=!t.Login,t.LoggedIn=!1,t.Login?t.currentState="Create Account":t.currentState="Go to Login",t.Login?t.formState="Login":t.formState="Register"})(),t.submit=function(r){var n=t.Login?o.login:o.register;console.log("user",r),n(r).success(function(o){t.LoggedIn=!0,e.go("home")}).error(function(e){t.user={},alert(e.message)})},t.logout=function(){o.logout(),t.LoggedIn=!1}}),app.factory("auth",function(t,e,o){var r={};return r.saveToken=function(e){t.localStorage[o]=e},r.getToken=function(){return t.localStorage[o]},r.isLoggedIn=function(){var e=r.getToken();if(e){var o=JSON.parse(t.atob(e.split(".")[1]));return o.exp>Date.now()/1e3}return!1},r.currentUser=function(){if(r.isLoggedIn()){var e=r.getToken(),o=JSON.parse(t.atob(e.split(".")[1]));return o.username}},r.register=function(t){return e.post("/users/register",t).success(function(t){r.saveToken(t.token)})},r.login=function(t){return e.post("/users/login",t).success(function(t){r.saveToken(t.token)})},r.logout=function(){t.localStorage.removeItem(o)},r});