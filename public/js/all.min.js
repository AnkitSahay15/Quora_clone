"use strict";var app=angular.module("quora",["ui.router"]);app.constant("tokenStorageKey","my-token"),app.config(function(e,t,r){t.html5Mode({enabled:!0,requireBase:!1}),e.state("home",{url:"/",templateUrl:"/html/general/home.html",controller:"homeCtrl"}).state("users",{"abstract":!0,templateUrl:"/html/users/users.html"}).state("users.login",{url:"/login",templateUrl:"/html/users/form.html",controller:"usersCtrl"}).state("users.profile",{url:"/profile",templateUrl:"/html/users/profile.html",controller:"profileCtrl"}),r.otherwise("/")});var app=angular.module("quora");app.controller("homeCtrl",function(e,t,r,o){});var app=angular.module("quora");app.controller("navCtrl",function(e,t,r){e.logout=function(){r.logout(),t.go("home")}});var app=angular.module("APP_NAME");app.controller("profileCtrl",function(e,t,r,o){}),app.controller("usersCtrl",function(e,t,r,o,n,a){e.Login=!1,(e.switchState=function(){e.Login=!e.Login,e.Login?e.currentState="Create Account":e.currentState="Go to Login",e.Login?e.formState="Login":e.formState="Register"})(),e.submit=function(r){var o=e.Login?n.login:n.register;o(r).success(function(e){t.go("home")}).error(function(t){e.user={},alert(t.message)})}});var app=angular.module("APP_NAME");app.factory("auth",function(e,t,r){var o={};return o.saveToken=function(t){e.localStorage[r]=t},o.getToken=function(){return e.localStorage[r]},o.isLoggedIn=function(){var t=o.getToken();if(t){var r=JSON.parse(e.atob(t.split(".")[1]));return r.exp>Date.now()/1e3}return!1},o.currentUser=function(){if(o.isLoggedIn()){var t=o.getToken(),r=JSON.parse(e.atob(t.split(".")[1]));return r.username}},o.register=function(e){return t.post("/users/register",e).success(function(e){o.saveToken(e.token)})},o.login=function(e){return t.post("/users/login",e).success(function(e){o.saveToken(e.token)})},o.logout=function(){e.localStorage.removeItem(r)},o});