"use strict";var app=angular.module("quora",["ui.router","infinite-scroll"]);app.constant("tokenStorageKey","my-token"),app.config(function(t,o,e){t.state("home",{url:"/",templateUrl:"/html/general/home.html",controller:"homeCtrl"}).state("users",{"abstract":!0,templateUrl:"/html/users/users.html"}).state("post",{url:"/post",templateUrl:"/html/general/post.html",controller:"writeCtrl"}).state("thread",{url:"/thread",templateUrl:"/html/general/thread.html",controller:"threadCtrl"}).state("users.login",{url:"/login",templateUrl:"/html/users/form.html",controller:"usersCtrl"}).state("users.profile",{url:"/profile",templateUrl:"/html/users/profile.html",controller:"profileCtrl"}),e.otherwise("/")}),app.controller("homeCtrl",function(t,o,e){}),app.controller("profileCtrl",function(t,o){console.log("PROFILE CTRL WORKING")}),app.controller("threadCtrl",function(t,o,e){console.log("THREAD CTRL WORKING"),t.displayComments=!1,t.displayAnswerForm=!1,t.showComments=function(){t.displayComments=!t.displayComments},t.showAnswerForm=function(){t.displayAnswerForm=!t.displayAnswerForm},t.comments=[{author:"billy",content:"this is a comment on a question in quora oh my god oh my god oh my god"},{author:"billy",content:"this is a comment on a question in quora oh my god oh my god oh my god",likes:19},{author:"billy",content:"this is a comment on a question in quora oh my god oh my god oh my god",views:19},{author:"billy",content:"this is a comment on a question in quora oh my god oh my god oh my god"},{author:"billy",content:"this is a comment on a question in quora oh my god oh my god oh my god"}],t.loadMore=function(){for(var o=t.comments[t.comments.length-1],e=8,n=1;e>=n;n++)console.log("count is "+n),t.comments.push(o+"")}}),app.controller("usersCtrl",function(t,o,e,n){t.Login=!1,t.LoggedIn=!0,(t.switchState=function(){t.Login=!t.Login,t.LoggedIn=!1,t.Login?t.currentState="Create Account":t.currentState="Go to Login",t.Login?t.formState="Login":t.formState="Register"})(),t.submit=function(n){var r=t.Login?e.login:e.register;console.log("user",n),r(n).success(function(e){t.LoggedIn=!0,o.go("home")}).error(function(o){t.user={},alert(o.message)})},t.logout=function(){e.logout(),t.LoggedIn=!1}}),app.controller("writeCtrl",function(t,o,e){console.log("post CTRL WORKING"),t.comments=["test comment 1","test comment 2","test comment 3","test comment 4","test comment 5","test comment 6","test comment 7","test comment 8"],t.loadMore=function(){for(var o=t.comments[t.comments.length-1],e=8,n=1;e>=n;n++)console.log("count is "+n),t.comments.push(o+"")}}),app.factory("auth",function(t,o,e){var n={};return n.saveToken=function(o){t.localStorage[e]=o},n.getToken=function(){return t.localStorage[e]},n.isLoggedIn=function(){var o=n.getToken();if(o){var e=JSON.parse(t.atob(o.split(".")[1]));return e.exp>Date.now()/1e3}return!1},n.currentUser=function(){if(n.isLoggedIn()){var o=n.getToken(),e=JSON.parse(t.atob(o.split(".")[1]));return e.username}},n.register=function(t){return o.post("/users/register",t).success(function(t){n.saveToken(t.token)})},n.login=function(t){return o.post("/users/login",t).success(function(t){n.saveToken(t.token)})},n.logout=function(){t.localStorage.removeItem(e)},n}),app.factory("postFactory",function(t,o){var e={};return e.createPost=function(t){return o.post("/posts/add",newPost)},e.deletePost=function(t){return o["delete"]("/posts/delete",t)},e.changeStats=function(t){return o.put("/posts/changeStats",t)},e.editPost=function(t){return o.put("/posts/edit",t)},e.getSorted=function(t){return o.get("/posts/sorted/"+t.tid+"/"+t.sortingMethod+"/"+t.tag)},e}),app.factory("topicFactory",function(t,o){var e={};return e.getTopics=function(){return o.get("/topics")},e.createTopic=function(t){return o.post("/topics/add",t)},e.deleteTopic=function(t){return o["delete"]("/topics/delete",t)},e}),app.factory("userFactory",function(t,o){var e={};return e.addKnowledge=function(t){return o.post("/users/addKnowledge",t)},e.updateInfo=function(t){return o.put("/users/updateInfo",t)},e.follow=function(t){return o.post("/posts/follow",t)},e.unfollow=function(t){return o.put("/posts/unfollow",t)},e.subscribe=function(t){return o.post("/posts/subscribe",subscribeObject)},e.unsubscribe=function(t){return o.put("/posts/unsubscribe",t)},e});