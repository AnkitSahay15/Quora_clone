"use strict";var app=angular.module("quora",["ui.router"]);app.constant("tokenStorageKey","my-token"),app.config(function(e,t,o){e.state("home",{url:"/",templateUrl:"/html/general/home.html",controller:"homeCtrl"}).state("users",{"abstract":!0,templateUrl:"/html/users/users.html"}).state("users.login",{url:"/login",templateUrl:"/html/users/form.html",controller:"usersCtrl"}).state("users.profile",{url:"/profile",templateUrl:"/html/users/profile.html",controller:"profileCtrl"}),o.otherwise("/")}),app.controller("homeCtrl",function(e,t){}),app.controller("profileCtrl",function(e,t){}),app.controller("usersCtrl",function(e,t,o){e.Login=!1,e.LoggedIn=!0,(e.switchState=function(){e.Login=!e.Login,e.LoggedIn=!1,e.Login?e.currentState="Create Account":e.currentState="Go to Login",e.Login?e.formState="Login":e.formState="Register"})(),e.submit=function(r){var n=e.Login?o.login:o.register;console.log("user",r),n(r).success(function(o){e.LoggedIn=!0,t.go("home")}).error(function(t){e.user={},alert(t.message)})},e.logout=function(){o.logout(),e.LoggedIn=!1}}),app.factory("auth",function(e,t,o){var r={};return r.saveToken=function(t){e.localStorage[o]=t},r.getToken=function(){return e.localStorage[o]},r.isLoggedIn=function(){var t=r.getToken();if(t){var o=JSON.parse(e.atob(t.split(".")[1]));return o.exp>Date.now()/1e3}return!1},r.currentUser=function(){if(r.isLoggedIn()){var t=r.getToken(),o=JSON.parse(e.atob(t.split(".")[1]));return o.username}},r.register=function(e){return t.post("/users/register",e).success(function(e){r.saveToken(e.token)})},r.login=function(e){return t.post("/users/login",e).success(function(e){r.saveToken(e.token)})},r.logout=function(){e.localStorage.removeItem(o)},r});